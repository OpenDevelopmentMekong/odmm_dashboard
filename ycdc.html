<html>
  <head>
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <script src="files/ygntsp.js"></script>
    <script src="files/candidateList.js"></script>
  </head>
  <body>
    <div id="mapExplorer">
    </div>
    <div class="candidateInfo">
      <h3>Township: <a class='township'></a></h3>
      <p>မြို့တော်ကော်မတီ၀င် -- <a class='committee'></a></p>
      <p>မြို့နယ်ဥက္ကဋ္ဌ -- <a class='chair'></a></p>
      <p>မြို့နယ်အဖွဲ့၀င် (၁) -- <a class='member1'></a></p>
      <p>မြို့နယ်အဖွဲ့၀င် (၂) -- <a class='member2'></a></p>
    </div>

    <script>
    // Store everything we need to draw a map
    candidateList = d3.csv.parse(candidateList);
    console.log(candidateList);
    var tspMap = {
      'geojson' : ygntsp.features,
      'width' : 500,
      'height' : 600,
      'projection' : '',
      'path' : '',
      'g' : ''
    };

    // Set up the HTML
    tspMap.g = d3.select('#mapExplorer')
      .append('svg')
      .attr('width', tspMap.width)
      .attr('height', tspMap.height)
      .append('g');

    // Set up the map projection
    tspMap.projection = d3.geo.mercator()
      .scale(60000)
      .center([96.1951, 16.8361])
      .translate([tspMap.width/2, tspMap.height/2]);

    // Path function here translates geoJSON to path strings required by SVG
    tspMap.path = d3.geo.path().projection(tspMap.projection);

    // Put it all together!
    tspMap.g.selectAll('path')
      .data(ygntsp.features)
      .enter()
      .append('path')
      .attr('fill', '#110000')
      .attr('stroke', '#aabbcc')
      .on('mouseover', function(d,i) {
        d3.select(this).attr('fill', '#00ee00');
      })
      .on('mouseout', function(d,i) {
        d3.select(this).attr('fill', '#110000');
      })
      .on('click', function(d,i) {
        var areaName = d.properties['TS'];
        mapClick(areaName);
      })
      .attr('d', tspMap.path);

    function mapClick(areaName) {
      var candidateInfo = '';
      for (i in candidateList) {
        if (candidateList[i]['Township'] == areaName) {
          candidateInfo = candidateList[i];
        }
      }

      if (candidateInfo != '') {
        var infoList = [];
        infoList.push(candidateInfo['Township']);
        infoList.push(candidateInfo['မြို့တော်ကော်မတီ၀င်']);
        infoList.push(candidateInfo['မြို့နယ်ဥက္ကဋ္ဌ']);
        infoList.push(candidateInfo['မြို့နယ်အဖွဲ့၀င် (၁)']);
        infoList.push(candidateInfo['မြို့နယ်အဖွဲ့၀င် (၂)']);

        d3.select('.candidateInfo')
          .selectAll('a')
          .data(infoList)
          .text((d) => (d));


      }
    }

    </script>

  </body>
</html>
